<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" 
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title></title>
</head>
<body>
    <main class="container">
        <div>
            <div>
                <h1>Form Rekrutasi</h1>
            </div>
            <hr>
            <div class="d-flex justify-content-center">
                <form style="width: 50%;" id="myForm">
                    <div class="mb-3">
                        <label for="fullName" class="form-label">Nama Lengkap</label>
                        <input class="form-control form-control-sm" type="text" name="fullname" id="fullname" placeholder="Masukkan Nama Lengkap">
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input class="form-control form-control-sm" type="email" name="email" id="email" placeholder="Masukkan Alamat Email">
                    </div>
                    <div class="mb-3">
                        <label for="phonenumber" class="form-label">Phone Number</label>
                        <input class="form-control form-control-sm" type="text" name="phonenumber" id="phonenumber" placeholder="Masukkan Nomor Telepon">
                    </div>
                    <div class="mb-3">
                        <label for="job" class="form-label">Job Vacancy</label>
                        <select class="form-select form-select-sm" name="job" id="job" onchange="checkQuota()"></select>
                        <span id="jobQuota"></span>
                    </div>
                    <div class="mb-3">
                        <label for="potition" class="form-label">Position</label>
                        <select class="form-select form-select-sm" name="position" id="position"></select>
                    </div>
                    <div class="d-grid gap-1">
                        <button type="submit" class="btn btn- btn-success" id="submitBtn">Submit</button>
                    </div>
                </form>
            </div>
        </div>
        <hr>
        <div id="afterSubmit"></div>
    </main>
</body>
<script src="https://code.jquery.com/jquery-3.7.0.slim.js" integrity="sha256-7GO+jepT9gJe9LB4XFf8snVOjX3iYNb0FHYr5LI1N5c=" crossorigin="anonymous"></script>
<script>
var Data = [];
var jobVacancy = ['- Pilih Lowongan Pekerjaan -', 'System Administrasi', 'Back End Developer', 'Front End Developer', 'Mobile Developer'];
var jobVacancyVal = ['', 1, 2, 3, 4];
var position = ['- Pilih Posisi Pekerjaan -', 'Jakarta', 'Bandung', 'Sukabumi', 'Bogor', 'Bekasi'];
var jobQuota = [0, 3, 4, 4, 5];

    function checkEmail(email) {
        let tmp = true;
        if (Data) {
            Data.forEach((val, idx) => {
                if (email == val[1]['value']) {
                    tmp = false;
                }
                // console.log(email);
            })
            if (!tmp) {alert('Email telah digunakan')};
        }
        return tmp;
    }

    function checkQuota() {
        let val = $('#job').val();

        if (jobQuota[val] == 0) {
            $('#jobQuota').text(`Mohon maaf, rekrutasi untuk ${jobVacancy[val]}sudah penuh.`);
            $('#submitBtn').addClass('disabled');
        }
        else if (jobQuota[val] <= 2) {
            $('#jobQuota').text(`Kuota tersisa untuk ${jobVacancy[val]} hanya ${jobQuota[val]} pendaftar.`);
        }
        else {
            $('#submitBtn').removeClass('disabled');
            $('#jobQuota').text('');
        }
        
    }

    function validateForm(data) {
        var stat = true;
        var text = '';
        data.forEach((form, idx) => {
            if (form['value'] === '') {
                switch (idx) {
                    case 0:
                        text+='Nama Lengkap';
                        break;
                    case 1:
                        text+='Alamat Email';
                        break;
                    case 2:
                        text+='Nomor Telepon';
                        break;
                    case 3:
                        text+='Lowongan Kerja';
                        break;
                    case 4:
                        if (text == '') {
                            text+='Posisi';
                        } else text+='dan Posisi';
                        break;
                
                    default:
                        break;
                }
                stat = false;
                if (idx != 4) text+=', ';
            };
        });
        if (!stat) {
            console.log(text);
            alert(`${text} Harus Diisi!`);
        }
        if (!checkEmail(data[1]['value'])) {
            stat = false
        };
        return stat;
    }
    
    $(document).ready(function (param) 
    {
        $('title').text('Form Lowongan Pekerjaan');
        
        var optionElement
        jobVacancy.forEach((opt, idx) => {
            optionElement = $('<option>');
            optionElement.val(jobVacancyVal[idx]);
            optionElement.text(opt);
            $('#job').append(optionElement);
        });
        position.forEach((opt, idx) => {
            optionElement = $('<option>');
            if (idx != 0) {
                optionElement.val(opt);
            }else {
                optionElement.val('');
            }
            optionElement.text(opt);
            $('#position').append(optionElement);
        });
        $('#myForm').submit(function(e) {
            e.preventDefault();
            
            var formData = $(this).serializeArray();
            // console.log(formData);
            if (validateForm(formData)) {
                Data.push(formData);
                jobQuota[formData[3]['value']]-=1;
                // console.log(jobQuota[formData[3]['value']]);
                $('#afterSubmit')
                    .html(`
                    <h1 class=\"text-success\">Terima Kasih telah mengisi Formulir ini. </h1>
                    Nama Lengkap : ${formData[0]['value']}<br>
                    Email : ${formData[1]['value']}<br>
                    Nomor Telepon : ${formData[2]['value']}<br>
                    Lowongan Kerja : ${jobVacancy[formData[3]['value']]}<br>
                    Posisi : ${formData[4]['value']}<br><br>
                    <h3>Jumlah Pelamar ${Data.length}</h3>
                    `);
                $('#myForm')[0].reset();
                $('#jobQuota').text('');
                console.log(Data);
            }
        });
    });
</script>
</html>